<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">Manage Events</h3>
            </div>
            <div class="card-body">
                <!-- Display Messages -->
                <% if (locals.message) { %>
                    <div class="alert alert-<%= message.type %> alert-dismissible fade show" role="alert">
                        <%= message.text %>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                <% } %>

                <!-- Event Management Tabs -->
                <ul class="nav nav-tabs mb-4" id="eventTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" type="button" role="tab" aria-controls="upcoming" aria-selected="true">
                            Upcoming Events
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="active-tab" data-bs-toggle="tab" data-bs-target="#active" type="button" role="tab" aria-controls="active" aria-selected="false">
                            Active Events
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab" aria-controls="completed" aria-selected="false">
                            Completed Events
                        </button>
                    </li>
                </ul>
                
                <!-- Quick Access Buttons -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <a href="/organizer/create-event" class="btn btn-success me-2">
                            <i class="fas fa-plus-circle me-2"></i>Create New Event
                        </a>
                    </div>
                </div>
                
                <!-- Search and Filter -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <form id="eventSearchForm">
                                    <div class="row">
                                        <div class="col-md-4 mb-3 mb-md-0">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                                <input type="text" class="form-control" id="eventSearch" placeholder="Search events...">
                                            </div>
                                    </div>
                                        <div class="col-md-3 mb-3 mb-md-0">
                                            <select class="form-select" id="sportFilter">
                                                <option value="">All Sports</option>
                                            <option value="Basketball">Basketball</option>
                                            <option value="Football">Football</option>
                                            <option value="Cricket">Cricket</option>
                                            <option value="Tennis">Tennis</option>
                                                <option value="Swimming">Swimming</option>
                                                <option value="Volleyball">Volleyball</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3 mb-md-0">
                                        <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                                <input type="date" class="form-control" id="dateFilter">
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                            <button type="reset" class="btn btn-outline-secondary w-100">
                                                <i class="fas fa-sync-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content" id="eventTabContent">
                    <!-- Upcoming Events Tab -->
                    <div class="tab-pane fade show active" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Event Name</th>
                                        <th>Date</th>
                                        <th>Location</th>
                                        <th>Sport</th>
                                        <th>Registration</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (typeof upcomingEvents !== 'undefined' && upcomingEvents.length > 0) { %>
                                        <% upcomingEvents.forEach(event => { %>
                                            <tr>
                                                <td><%= event.name %></td>
                                                <td><%= event.date %></td>
                                                <td><%= event.location %></td>
                                                <td><%= event.sport %></td>
                                                <td>
                                                    <div class="progress" style="height: 8px;">
                                                        <% const progressPercentage = Math.round((event.teams_registered / event.max_teams) * 100); %>
                                                        <div class="progress-bar bg-primary" role="progressbar" style="width: <%= progressPercentage %>%" aria-valuenow="<%= progressPercentage %>" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                    <small><%= event.teams_registered %>/<%= event.max_teams %> teams</small>
                                                </td>
                                                <td>
                                                    <span class="badge bg-<%= event.status === 'Open' ? 'success' : (event.status === 'Full' ? 'warning' : 'danger') %>">
                                                <%= event.status %>
                                                    </span>
                                                </td>
                                                <td>
                                                    <div class="btn-group">
                                                        <a href="/organizer/event/<%= event.id %>" class="btn btn-sm btn-outline-primary">
                                                            <i class="fas fa-eye"></i>
                                                        </a>
                                                        <a href="/organizer/event/<%= event.id %>/edit" class="btn btn-sm btn-outline-warning">
                                                            <i class="fas fa-edit"></i>
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                <% }); %>
                        <% } else { %>
                                        <tr>
                                            <td colspan="7" class="text-center py-3">No upcoming events found</td>
                                        </tr>
                                    <% } %>
                                </tbody>
                            </table>
                            </div>
                    </div>

                    <!-- Active Events Tab -->
                    <div class="tab-pane fade" id="active" role="tabpanel" aria-labelledby="active-tab">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                <thead class="bg-light">
                                        <tr>
                                            <th>Event Name</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Location</th>
                                            <th>Sport</th>
                                            <th>Participants</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    <% if (typeof activeEvents !== 'undefined' && activeEvents.length > 0) { %>
                                        <% activeEvents.forEach(event => { %>
                                            <tr>
                                                <td><%= event.name %></td>
                                                <td><%= event.start_date %></td>
                                                <td><%= event.end_date %></td>
                                                <td><%= event.location %></td>
                                                <td><%= event.sport %></td>
                                                <td><%= event.participants_count %> teams</td>
                                                <td>
                                                    <div class="btn-group">
                                                        <a href="/organizer/event/<%= event.id %>/dashboard" class="btn btn-sm btn-outline-primary">
                                                            <i class="fas fa-tachometer-alt"></i>
                                                        </a>
                                                        <a href="/organizer/event/<%= event.id %>/teams" class="btn btn-sm btn-outline-info">
                                                            <i class="fas fa-users"></i>
                                                        </a>
                                                        <a href="/organizer/event/<%= event.id %>/results" class="btn btn-sm btn-outline-success">
                                                            <i class="fas fa-trophy"></i>
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                        <% }); %>
                                    <% } else { %>
                                        <tr>
                                            <td colspan="7" class="text-center py-3">No active events found</td>
                                        </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Completed Events Tab -->
                    <div class="tab-pane fade" id="completed" role="tabpanel" aria-labelledby="completed-tab">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Event Name</th>
                                        <th>Date</th>
                                        <th>Location</th>
                                        <th>Sport</th>
                                        <th>Teams</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (typeof completedEvents !== 'undefined' && completedEvents.length > 0) { %>
                                        <% completedEvents.forEach(event => { %>
                                            <tr>
                                                <td><%= event.name %></td>
                                                <td><%= event.date %></td>
                                                <td><%= event.location %></td>
                                                <td><%= event.sport %></td>
                                                <td><%= event.teams_count %> teams</td>
                                                <td>
                                                    <span class="badge bg-secondary">Completed</span>
                                                </td>
                                                <td>
                                                    <div class="btn-group">
                                                        <a href="/organizer/event/<%= event.id %>/results" class="btn btn-sm btn-outline-primary">
                                                            <i class="fas fa-trophy"></i> Results
                                                        </a>
                                                        <a href="/organizer/event/<%= event.id %>/analytics" class="btn btn-sm btn-outline-info">
                                                            <i class="fas fa-chart-bar"></i>
                                                        </a>
                                                        <a href="/organizer/event/<%= event.id %>/duplicate" class="btn btn-sm btn-outline-success">
                                                            <i class="fas fa-copy"></i>
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                        <% }); %>
                                    <% } else { %>
                                        <tr>
                                            <td colspan="7" class="text-center py-3">No completed events found</td>
                                        </tr>
                                    <% } %>
                                    </tbody>
                                </table>
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Event Modal -->
<div class="modal fade" id="deleteEventModal" tabindex="-1" aria-labelledby="deleteEventModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteEventModalLabel">Confirm Event Deletion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                <p>Are you sure you want to delete the event "<span id="eventNameToDelete"></span>"?</p>
                <p class="text-danger">This action cannot be undone. All registrations and data associated with this event will be permanently deleted.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteEventForm" action="/organizer/event/delete" method="POST">
                    <input type="hidden" id="eventIdToDelete" name="eventId">
                    <button type="submit" class="btn btn-danger">Delete Event</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize delete event modal
        const deleteEventModal = document.getElementById('deleteEventModal');
        if (deleteEventModal) {
            deleteEventModal.addEventListener('show.bs.modal', function(event) {
                const button = event.relatedTarget;
                const eventId = button.getAttribute('data-event-id');
                const eventName = button.getAttribute('data-event-name');
                
                document.getElementById('eventNameToDelete').textContent = eventName;
                document.getElementById('eventIdToDelete').value = eventId;
            });
        }
        
        // Event search filter functionality
        const eventSearchForm = document.getElementById('eventSearchForm');
        const eventSearch = document.getElementById('eventSearch');
        const sportFilter = document.getElementById('sportFilter');
        const dateFilter = document.getElementById('dateFilter');
        
        if (eventSearch) {
            eventSearch.addEventListener('input', filterEvents);
        }
        
        if (sportFilter) {
            sportFilter.addEventListener('change', filterEvents);
        }
        
        if (dateFilter) {
            dateFilter.addEventListener('change', filterEvents);
        }
        
        if (eventSearchForm) {
            eventSearchForm.addEventListener('reset', function() {
                setTimeout(filterEvents, 10); // Small delay to ensure form values are reset first
            });
        }
        
        function filterEvents() {
            const searchTerm = eventSearch.value.toLowerCase();
            const selectedSport = sportFilter.value;
            const selectedDate = dateFilter.value;
            
            // Get the active tab
            const activeTab = document.querySelector('.tab-pane.active');
            if (!activeTab) return;
            
            // Get all event rows in the active tab
            const rows = activeTab.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const name = row.cells[0]?.textContent.toLowerCase() || '';
                const date = row.cells[1]?.textContent || '';
                const location = row.cells[2]?.textContent.toLowerCase() || '';
                const sport = row.cells[3]?.textContent || '';
                
                // Check if the row matches all selected filters
                const matchesSearch = name.includes(searchTerm) || location.includes(searchTerm);
                const matchesSport = !selectedSport || sport === selectedSport;
                const matchesDate = !selectedDate || date.includes(selectedDate);
                
                // Show/hide the row based on filter results
                row.style.display = matchesSearch && matchesSport && matchesDate ? '' : 'none';
            });
        }
    });
</script> 