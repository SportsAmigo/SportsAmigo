<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h3 class="mb-0">Organizer Dashboard</h3>
            </div>
            <div class="card-body">
                <!-- Dashboard content for new organizers vs. existing organizers -->
                <% if (typeof isNewOrganizer !== 'undefined' && isNewOrganizer) { %>
                    <!-- New organizer welcome message -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card border-primary">
                                <div class="card-body">
                                    <h3 class="card-title"><i class="bi bi-hand-thumbs-up me-2"></i>Welcome to Sports Amigo!</h3>
                                    <p class="card-text">Thank you for registering as an event organizer. Here are some tips to get started:</p>
                                    
                                    <div class="row mt-4">
                                        <div class="col-md-4">
                                            <div class="d-flex align-items-center mb-3">
                                                <div class="bg-primary rounded-circle p-3 me-3 text-white">
                                                    <i class="bi bi-person-fill"></i>
                                                </div>
                                                <div>
                                                    <h5 class="mb-1">Complete Your Profile</h5>
                                                    <p class="mb-0 small text-muted">Add your personal details to build trust with participants.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="d-flex align-items-center mb-3">
                                                <div class="bg-primary rounded-circle p-3 me-3 text-white">
                                                    <i class="bi bi-calendar-plus"></i>
                                                </div>
                                                <div>
                                                    <h5 class="mb-1">Create Your First Event</h5>
                                                    <p class="mb-0 small text-muted">Set up a sports event with all the necessary details.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="d-flex align-items-center mb-3">
                                                <div class="bg-primary rounded-circle p-3 me-3 text-white">
                                                    <i class="bi bi-share"></i>
                                                </div>
                                                <div>
                                                    <h5 class="mb-1">Promote Your Event</h5>
                                                    <p class="mb-0 small text-muted">Share your event with your network to boost attendance.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <a href="/organizer/profile" class="btn btn-outline-primary me-2">
                                            <i class="bi bi-person-circle me-1"></i> Complete Profile
                                        </a>
                                        <a href="/organizer/create-event" class="btn btn-primary">
                                            <i class="bi bi-plus-circle me-1"></i> Create First Event
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <% } else { %>
                    <!-- Regular dashboard content for existing organizers -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-body">
                                    <h3 class="card-title mb-4">Organizer Dashboard</h3>
                                    
                                    <div class="row">
                                        <!-- Statistics cards -->
                                        <div class="col-md-3">
                                            <div class="card dashboard-stat-card bg-primary text-white">
                                                <div class="card-body">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h6 class="card-title">Total Events</h6>
                                                            <h2 class="mb-0"><%= typeof totalEventsCount !== 'undefined' ? totalEventsCount : 15 %></h2>
                                                        </div>
                                                        <div class="card-icon">
                                                            <i class="fas fa-calendar-alt fa-2x"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card dashboard-stat-card bg-success text-white">
                                                <div class="card-body">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h6 class="card-title">Upcoming Events</h6>
                                                            <h2 class="mb-0"><%= typeof upcomingEventsCount !== 'undefined' ? upcomingEventsCount : 4 %></h2>
                                                        </div>
                                                        <div class="card-icon">
                                                            <i class="fas fa-calendar-plus fa-2x"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card dashboard-stat-card bg-info text-white">
                                                <div class="card-body">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h6 class="card-title">Registered Teams</h6>
                                                            <h2 class="mb-0"><%= typeof registeredTeamsCount !== 'undefined' ? registeredTeamsCount : 32 %></h2>
                                                        </div>
                                                        <div class="card-icon">
                                                            <i class="fas fa-users fa-2x"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card dashboard-stat-card bg-danger text-white">
                                                <div class="card-body">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h6 class="card-title">Cancelled Events</h6>
                                                            <h2 class="mb-0"><%= typeof cancelledEventsCount !== 'undefined' ? cancelledEventsCount : 1 %></h2>
                                                        </div>
                                                        <div class="card-icon">
                                                            <i class="fas fa-calendar-times fa-2x"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Welcome Message for existing organizers -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h4 class="card-title">Welcome back, <%= user.first_name || user.name?.split(' ')[0] || user.email %>!</h4>
                            <% if (nextEvent) { %>
                                <p class="card-text">Your next event <strong><%= nextEvent.name %></strong> is scheduled for <strong><%= nextEvent.date %></strong>. You have <strong><%= nextEvent.teams_registered %></strong> registered teams so far.</p>
                                <a href="/organizer/event/<%= nextEvent.id %>" class="btn btn-primary">Manage Event</a>
                            <% } else { %>
                                <p class="card-text">You don't have any upcoming events scheduled. Would you like to create one?</p>
                                <a href="/organizer/create-event" class="btn btn-primary">Create Event</a>
                            <% } %>
                        </div>
                    </div>
                <% } %>

                <!-- Quick Access Cards -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">Upcoming Events</h5>
                            </div>
                            <div class="card-body">
                                <% if (typeof isNewOrganizer !== 'undefined' && isNewOrganizer) { %>
                                    <div class="text-center py-3">
                                        <i class="bi bi-calendar3 fs-1 text-muted"></i>
                                        <p class="mt-2">No events created yet.</p>
                                        <a href="/organizer/create-event" class="btn btn-primary mt-2">Create Your First Event</a>
                                    </div>
                                <% } else { %>
                                    <ul class="list-group list-group-flush">
                                        <% if (upcomingEvents && upcomingEvents.length > 0) { %>
                                            <% upcomingEvents.forEach(event => { %>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    <%= event.name %>
                                                    <span class="badge bg-primary"><%= event.date %></span>
                                                </li>
                                            <% }); %>
                                        <% } else { %>
                                            <li class="list-group-item text-center py-3">
                                                <p>No upcoming events found</p>
                                            </li>
                                        <% } %>
                                    </ul>
                                    <div class="mt-3">
                                        <a href="/organizer/manage-events" class="btn btn-outline-primary">See All Events</a>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0">Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <a href="/organizer/create-event" class="btn btn-success w-100">Create New Event</a>
                                </div>
                                <div class="mb-3">
                                    <a href="/organizer/reports" class="btn btn-info w-100">View Reports</a>
                                </div>
                                <div>
                                    <a href="/organizer/profile" class="btn btn-warning w-100">Edit Profile</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity & Analytics -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0">Recent Activity</h5>
                            </div>
                            <div class="card-body p-0">
                                <% if (typeof isNewOrganizer !== 'undefined' && isNewOrganizer) { %>
                                    <div class="text-center py-4">
                                        <i class="bi bi-activity fs-1 text-muted"></i>
                                        <p class="mt-2">No recent activity.</p>
                                        <p class="text-muted small">Activities will appear here once you create your first event.</p>
                                    </div>
                                <% } else { %>
                                    <ul class="list-group list-group-flush">
                                        <% if (recentActivities && recentActivities.length > 0) { %>
                                            <% recentActivities.forEach(activity => { %>
                                                <li class="list-group-item">
                                                    <small class="text-muted"><%= activity.formatted_date %></small>
                                                    <p class="mb-0"><%= activity.message %></p>
                                                </li>
                                            <% }); %>
                                        <% } else { %>
                                            <li class="list-group-item text-center py-3">
                                                <p>No recent activity found</p>
                                            </li>
                                        <% } %>
                                    </ul>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0">Analytics Overview</h5>
                            </div>
                            <div class="card-body">
                                <% if (typeof isNewOrganizer !== 'undefined' && isNewOrganizer) { %>
                                    <div class="text-center py-4">
                                        <i class="bi bi-bar-chart fs-1 text-muted"></i>
                                        <p class="mt-2">No analytics data available yet.</p>
                                        <p class="text-muted small">Analytics will be available once you create your first event.</p>
                                    </div>
                                <% } else { %>
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <h6 class="card-subtitle mb-3">Event Status Distribution</h6>
                                            <div class="mb-2 d-flex justify-content-between">
                                                <span>Upcoming</span>
                                                <span class="text-primary font-weight-bold"><%= upcomingEventsCount %></span>
                                            </div>
                                            <div class="progress mb-3" style="height: 10px;">
                                                <div class="progress-bar bg-primary" style="width: <%= totalEventsCount ? (upcomingEventsCount / totalEventsCount) * 100 : 0 %>%"></div>
                                            </div>
                                            
                                            <div class="mb-2 d-flex justify-content-between">
                                                <span>Completed</span>
                                                <span class="text-success font-weight-bold"><%= completedEventsCount || 0 %></span>
                                            </div>
                                            <div class="progress mb-3" style="height: 10px;">
                                                <div class="progress-bar bg-success" style="width: <%= totalEventsCount ? (completedEventsCount / totalEventsCount) * 100 : 0 %>%"></div>
                                            </div>
                                            
                                            <div class="mb-2 d-flex justify-content-between">
                                                <span>Cancelled</span>
                                                <span class="text-danger font-weight-bold"><%= cancelledEventsCount %></span>
                                            </div>
                                            <div class="progress mb-3" style="height: 10px;">
                                                <div class="progress-bar bg-danger" style="width: <%= totalEventsCount ? (cancelledEventsCount / totalEventsCount) * 100 : 0 %>%"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <h6 class="card-subtitle mb-3">Event Creation Trend</h6>
                                            <% if (monthlyEventCounts && monthlyEventCounts.length > 0) { %>
                                                <div class="mt-3">
                                                    <canvas id="eventTrendChart" width="100%" height="200"></canvas>
                                                </div>
                                                
                                                <script>
                                                    document.addEventListener('DOMContentLoaded', function() {
                                                        // Event Trend Chart
                                                        const trendCtx = document.getElementById('eventTrendChart').getContext('2d');
                                                        const trendChart = new Chart(trendCtx, {
                                                            type: 'line',
                                                            data: {
                                                                labels: [<%= monthlyEventCounts.map(m => `'${m.month}'`).join(',') %>],
                                                                datasets: [{
                                                                    label: 'Events Created',
                                                                    data: [<%= monthlyEventCounts.map(m => m.count).join(',') %>],
                                                                    backgroundColor: 'rgba(255, 193, 7, 0.2)',
                                                                    borderColor: 'rgba(255, 193, 7, 1)',
                                                                    borderWidth: 2,
                                                                    tension: 0.3
                                                                }]
                                                            },
                                                            options: {
                                                                maintainAspectRatio: false,
                                                                scales: {
                                                                    y: {
                                                                        beginAtZero: true,
                                                                        ticks: {
                                                                            stepSize: 1,
                                                                            precision: 0
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        });
                                                    });
                                                </script>
                                            <% } else { %>
                                                <p class="text-muted">Not enough data to show trends.</p>
                                            <% } %>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Organizer Dashboard -->
<div class="row">
    <!-- Statistics Cards -->
    <div class="col-md-12 mb-4">
        <div class="row">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted">Total Events</h6>
                                <h3 class="mb-0"><%= typeof totalEventsCount !== 'undefined' ? totalEventsCount : 15 %></h3>
                            </div>
                            <div class="bg-primary rounded p-3 text-white">
                                <i class="fas fa-calendar-alt fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted">Upcoming Events</h6>
                                <h3 class="mb-0"><%= typeof upcomingEventsCount !== 'undefined' ? upcomingEventsCount : 4 %></h3>
                            </div>
                            <div class="bg-success rounded p-3 text-white">
                                <i class="fas fa-calendar-plus fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted">Registered Teams</h6>
                                <h3 class="mb-0"><%= typeof registeredTeamsCount !== 'undefined' ? registeredTeamsCount : 32 %></h3>
                            </div>
                            <div class="bg-info rounded p-3 text-white">
                                <i class="fas fa-users fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted">Cancelled Events</h6>
                                <h3 class="mb-0"><%= typeof cancelledEventsCount !== 'undefined' ? cancelledEventsCount : 1 %></h3>
                            </div>
                            <div class="bg-danger rounded p-3 text-white">
                                <i class="fas fa-calendar-times fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Welcome and Quick Actions -->
    <div class="col-md-12 mb-4">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Welcome, <%= user.name || 'Organizer' %>!</h5>
                <p class="text-muted">Here's your dashboard overview. You can quickly create new events, manage existing ones, and view reports.</p>
                <div class="row mt-4">
                    <div class="col-md-4">
                        <a href="/organizer/create-event" class="btn btn-primary w-100">
                            <i class="fas fa-plus-circle me-2"></i> Create New Event
                        </a>
                    </div>
                    <div class="col-md-4">
                        <a href="/organizer/manage-events" class="btn btn-info w-100 text-white">
                            <i class="fas fa-tasks me-2"></i> Manage Events
                        </a>
                    </div>
                    <div class="col-md-4">
                        <a href="/organizer/reports" class="btn btn-success w-100">
                            <i class="fas fa-chart-bar me-2"></i> View Reports
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Upcoming Events and Recent Activities -->
    <div class="col-md-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Upcoming Events</h5>
                    <a href="/organizer/manage-events" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush">
                    <% if (typeof upcomingEvents !== 'undefined' && upcomingEvents.length > 0) { %>
                        <% upcomingEvents.forEach(event => { %>
                            <a href="/organizer/event/<%= event.id %>" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1"><%= event.name %></h6>
                                    <small class="text-muted"><%= event.date %></small>
                                </div>
                                <p class="mb-1 text-muted"><i class="fas fa-map-marker-alt me-2"></i><%= event.location %></p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-<%= event.status === 'Open' ? 'success' : 'secondary' %>">
                                        <i class="fas fa-circle me-1"></i><%= event.status %>
                                    </small>
                                    <small class="text-muted">
                                        <i class="fas fa-users me-1"></i> <%= event.teams_registered %>/<%= event.max_teams %> teams
                                    </small>
                                </div>
                            </a>
                        <% }); %>
                    <% } else { %>
                        <div class="list-group-item">
                            <p class="mb-0 text-center">No upcoming events</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Recent Activities</h5>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush">
                    <% if (typeof recentActivities !== 'undefined' && recentActivities.length > 0) { %>
                        <% recentActivities.forEach(activity => { %>
                            <div class="list-group-item">
                                <div class="d-flex">
                                    <div class="me-3">
                                        <% if (activity.type === 'event_created') { %>
                                            <span class="badge rounded-pill bg-primary p-2">
                                                <i class="fas fa-plus"></i>
                                            </span>
                                        <% } else if (activity.type === 'team_registered') { %>
                                            <span class="badge rounded-pill bg-success p-2">
                                                <i class="fas fa-user-plus"></i>
                                            </span>
                                        <% } else if (activity.type === 'event_updated') { %>
                                            <span class="badge rounded-pill bg-info p-2">
                                                <i class="fas fa-edit"></i>
                                            </span>
                                        <% } else if (activity.type === 'event_cancelled') { %>
                                            <span class="badge rounded-pill bg-danger p-2">
                                                <i class="fas fa-times"></i>
                                            </span>
                                        <% } %>
                                    </div>
                                    <div>
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1"><%= activity.title %></h6>
                                            <small class="text-muted"><%= new Date(activity.date).toLocaleDateString() %></small>
                                        </div>
                                        <p class="mb-1"><%= activity.message %></p>
                                    </div>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div class="list-group-item">
                            <p class="mb-0 text-center">No recent activities</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Performance Overview -->
    <div class="col-md-12 mt-4">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">Events Performance Overview</h5>
            </div>
            <div class="card-body">
                <canvas id="eventsChart" height="100"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Sample data for the chart
        const eventsData = {
            labels: ['January', 'February', 'March', 'April', 'May', 'June'],
            datasets: [
                {
                    label: 'Events Created',
                    data: [3, 5, 2, 4, 6, 3],
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2,
                    tension: 0.4
                },
                {
                    label: 'Teams Registered',
                    data: [12, 19, 10, 15, 22, 16],
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    tension: 0.4
                }
            ]
        };

        // Chart configuration
        const ctx = document.getElementById('eventsChart').getContext('2d');
        const eventsChart = new Chart(ctx, {
            type: 'line',
            data: eventsData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });
</script> 