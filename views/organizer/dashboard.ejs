<%- include('../partials/header', { title: 'Organizer Dashboard - Sports Amigo' }) %>

<!-- Dashboard Content -->
<div class="container-fluid">
    <!-- Dashboard Stats Row -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card dashboard-stat-card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Total Events</h6>
                            <h2 class="mb-0"><%= typeof totalEventsCount !== 'undefined' ? totalEventsCount : 0 %></h2>
                        </div>
                        <div class="card-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card dashboard-stat-card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Upcoming Events</h6>
                            <h2 class="mb-0"><%= typeof upcomingEventsCount !== 'undefined' ? upcomingEventsCount : 0 %></h2>
                        </div>
                        <div class="card-icon">
                            <i class="fas fa-calendar-plus"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card dashboard-stat-card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Registered Teams</h6>
                            <h2 class="mb-0"><%= typeof registeredTeamsCount !== 'undefined' ? registeredTeamsCount : 0 %></h2>
                        </div>
                        <div class="card-icon">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card dashboard-stat-card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Completed Events</h6>
                            <h2 class="mb-0"><%= typeof completedEventsCount !== 'undefined' ? completedEventsCount : 0 %></h2>
                        </div>
                        <div class="card-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
                        <div class="card-body">
                            <h4 class="card-title">Welcome back, <%= user.first_name || user.name?.split(' ')[0] || user.email %>!</h4>
                            <% if (typeof nextEvent !== 'undefined' && nextEvent) { %>
                                <p class="card-text">Your next event <strong><%= nextEvent.name %></strong> is scheduled for <strong><%= nextEvent.date %></strong>. You have <strong><%= nextEvent.teams_registered %></strong> registered teams so far.</p>
                                <a href="/organizer/event/<%= nextEvent.id %>" class="btn btn-primary">Manage Event</a>
                            <% } else { %>
                                <p class="card-text">You don't have any upcoming events scheduled. Would you like to create one?</p>
                                <a href="/organizer/create-event" class="btn btn-primary">Create Event</a>
                            <% } %>
                        </div>
                    </div>
                <% } %>

                <!-- Quick Access Cards -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">Upcoming Events</h5>
                            </div>
                            <div class="card-body">
                                <% if (typeof isNewOrganizer !== 'undefined' && isNewOrganizer) { %>
                                    <div class="text-center py-3">
                                        <i class="bi bi-calendar3 fs-1 text-muted"></i>
                                        <p class="mt-2">No events created yet.</p>
                                        <a href="/organizer/create-event" class="btn btn-primary mt-2">Create Your First Event</a>
                                    </div>
                                <% } else { %>
                                    <ul class="list-group list-group-flush">
                                        <% if (upcomingEvents && upcomingEvents.length > 0) { %>
                                            <% upcomingEvents.forEach(event => { %>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    <%= event.name %>
                                                    <span class="badge bg-primary"><%= event.date %></span>
                                                </li>
                                            <% }); %>
                                        <% } else { %>
                                            <li class="list-group-item text-center py-3">
                                                <p>No upcoming events found</p>
                                            </li>
                                        <% } %>
                                    </ul>
                                    <div class="mt-3">
                                        <a href="/organizer/manage-events" class="btn btn-outline-primary">See All Events</a>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0">Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <a href="/organizer/create-event" class="btn btn-success w-100">Create New Event</a>
                                </div>
                                <div class="mb-3">
                                    <a href="/organizer/reports" class="btn btn-info w-100">View Reports</a>
                                </div>
                                <div>
                                    <a href="/organizer/profile" class="btn btn-warning w-100">Edit Profile</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity & Analytics -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0">Recent Activity</h5>
                            </div>
                            <div class="card-body p-0">
                                <% if (typeof isNewOrganizer !== 'undefined' && isNewOrganizer) { %>
                                    <div class="text-center py-4">
                                        <i class="bi bi-activity fs-1 text-muted"></i>
                                        <p class="mt-2">No recent activity.</p>
                                        <p class="text-muted small">Activities will appear here once you create your first event.</p>
                                    </div>
                                <% } else { %>
                                    <ul class="list-group list-group-flush">
                                        <% if (recentActivities && recentActivities.length > 0) { %>
                                            <% recentActivities.forEach(activity => { %>
                                                <li class="list-group-item">
                                                    <small class="text-muted"><%= activity.formatted_date %></small>
                                                    <p class="mb-0"><%= activity.message %></p>
                                                </li>
                                            <% }); %>
                                        <% } else { %>
                                            <li class="list-group-item text-center py-3">
                                                <p>No recent activity found</p>
                                            </li>
                                        <% } %>
                                    </ul>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0">Analytics Overview</h5>
                            </div>
                            <div class="card-body">
                                <% if (typeof isNewOrganizer !== 'undefined' && isNewOrganizer) { %>
                                    <div class="text-center py-4">
                                        <i class="bi bi-bar-chart fs-1 text-muted"></i>
                                        <p class="mt-2">No analytics data available yet.</p>
                                        <p class="text-muted small">Analytics will be available once you create your first event.</p>
                                    </div>
                                <% } else { %>
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <h6 class="card-subtitle mb-3">Event Status Distribution</h6>
                                            <div class="mb-2 d-flex justify-content-between">
                                                <span>Upcoming</span>
                                                <span class="text-primary font-weight-bold"><%= upcomingEventsCount %></span>
                                            </div>
                                            <div class="progress mb-3" style="height: 10px;">
                                                <div class="progress-bar bg-primary" style="width: <%= totalEventsCount ? (upcomingEventsCount / totalEventsCount) * 100 : 0 %>%"></div>
                                            </div>
                                            
                                            <div class="mb-2 d-flex justify-content-between">
                                                <span>Completed</span>
                                                <span class="text-success font-weight-bold"><%= completedEventsCount || 0 %></span>
                                            </div>
                                            <div class="progress mb-3" style="height: 10px;">
                                                <div class="progress-bar bg-success" style="width: <%= totalEventsCount ? (completedEventsCount / totalEventsCount) * 100 : 0 %>%"></div>
                                            </div>
                                            
                                            <div class="mb-2 d-flex justify-content-between">
                                                <span>Cancelled</span>
                                                <span class="text-danger font-weight-bold"><%= cancelledEventsCount %></span>
                                            </div>
                                            <div class="progress mb-3" style="height: 10px;">
                                                <div class="progress-bar bg-danger" style="width: <%= totalEventsCount ? (cancelledEventsCount / totalEventsCount) * 100 : 0 %>%"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <h6 class="card-subtitle mb-3">Event Creation Trend</h6>
                                            <% if (monthlyEventCounts && monthlyEventCounts.length > 0) { %>
                                                <div class="mt-3">
                                                    <canvas id="eventTrendChart" width="100%" height="200"></canvas>
                                                </div>
                                                
                                                <script>
                                                    document.addEventListener('DOMContentLoaded', function() {
                                                        // Event Trend Chart
                                                        const trendCtx = document.getElementById('eventTrendChart').getContext('2d');
                                                        const trendChart = new Chart(trendCtx, {
                                                            type: 'line',
                                                            data: {
                                                                labels: [<%= monthlyEventCounts.map(m => `'${m.month}'`).join(',') %>],
                                                                datasets: [{
                                                                    label: 'Events Created',
                                                                    data: [<%= monthlyEventCounts.map(m => m.count).join(',') %>],
                                                                    backgroundColor: 'rgba(255, 193, 7, 0.2)',
                                                                    borderColor: 'rgba(255, 193, 7, 1)',
                                                                    borderWidth: 2,
                                                                    tension: 0.3
                                                                }]
                                                            },
                                                            options: {
                                                                maintainAspectRatio: false,
                                                                scales: {
                                                                    y: {
                                                                        beginAtZero: true,
                                                                        ticks: {
                                                                            stepSize: 1,
                                                                            precision: 0
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        });
                                                    });
                                                </script>
                                            <% } else { %>
                                                <p class="text-muted">Not enough data to show trends.</p>
                                            <% } %>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('../partials/footer') %>
