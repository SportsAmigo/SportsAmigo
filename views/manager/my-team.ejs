<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h3 class="mb-0">My Team</h3>
                <a href="/manager/create-team" class="btn btn-light d-none">Create New Team</a>
            </div>
            <div class="card-body">
                <!-- Add navigation test buttons at the top of the page -->
                <div class="mb-4">
                    <h4>Navigation Test:</h4>
                    <div class="btn-group">
                        <a href="/manager/player-performance" class="btn btn-primary">Go to Performance</a>
                        <a href="/manager/browse-events" class="btn btn-success">Go to Browse Events</a>
                        <a href="/manager" class="btn btn-info">Go to Dashboard</a>
                    </div>
                </div>
                <% if (typeof teams !== 'undefined' && teams.length > 0) { %>
                    <% const team = teams[0]; %> 
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card border-0 shadow-sm mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">Team Information</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex justify-content-between">
                                            <strong>Team Name:</strong>
                                            <span><%= team.name %></span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between">
                                            <strong>Sport:</strong>
                                            <span><%= team.sport %></span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between">
                                            <strong>Players:</strong>
                                            <span>
                                                <% if (team.player_count) { %>
                                                    <%= team.player_count %> / <%= team.members || 'N/A' %>
                                                <% } else { %>
                                                    0 / <%= team.members || 'N/A' %>
                                                <% } %>
                                            </span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between">
                                            <strong>Status:</strong>
                                            <span class="badge bg-<%= team.status === 'Active' ? 'success' : team.status === 'Pending' ? 'warning' : 'secondary' %>">
                                                <%= team.status %>
                                            </span>
                                        </li>
                                    </ul>
                                    <div class="d-grid gap-2 mt-3">
                                        <a href="/manager/team/<%= team.id %>/edit" class="btn btn-warning">Edit Team</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-8">
                            <div class="card border-0 shadow-sm">
                                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Team Members</h5>
                                    <a href="/manager/team/<%= team.id %>/members/add" class="btn btn-sm btn-primary">Add Player</a>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Name</th>
                                                    <th>Position</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Example player rows, replace with actual data -->
                                                <% if (team.players && team.players.length > 0) { %>
                                                    <% team.players.forEach((player, index) => { %>
                                                        <tr>
                                                            <td><%= index + 1 %></td>
                                                            <td><%= player.name %></td>
                                                            <td><%= player.position || 'N/A' %></td>
                                                            <td><span class="badge bg-success">Active</span></td>
                                                            <td>
                                                                <div class="btn-group btn-group-sm">
                                                                    <a href="/manager/player/<%= player.id %>" class="btn btn-info">View</a>
                                                                    <a href="/manager/player/<%= player.id %>/edit" class="btn btn-warning">Edit</a>
                                                                    <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#removePlayerModal<%= player.id %>">Remove</button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    <% }); %>
                                                <% } else { %>
                                                    <tr>
                                                        <td>1</td>
                                                        <td>John Smith</td>
                                                        <td>Point Guard</td>
                                                        <td><span class="badge bg-success">Active</span></td>
                                                        <td>
                                                            <div class="btn-group btn-group-sm">
                                                                <a href="/manager/player/1" class="btn btn-info">View</a>
                                                                <a href="/manager/player/1/edit" class="btn btn-warning">Edit</a>
                                                                <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#removePlayerModal1">Remove</button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>2</td>
                                                        <td>Michael Johnson</td>
                                                        <td>Center</td>
                                                        <td><span class="badge bg-success">Active</span></td>
                                                        <td>
                                                            <div class="btn-group btn-group-sm">
                                                                <a href="/manager/player/2" class="btn btn-info">View</a>
                                                                <a href="/manager/player/2/edit" class="btn btn-warning">Edit</a>
                                                                <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#removePlayerModal2">Remove</button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>3</td>
                                                        <td>David Miller</td>
                                                        <td>Shooting Guard</td>
                                                        <td><span class="badge bg-success">Active</span></td>
                                                        <td>
                                                            <div class="btn-group btn-group-sm">
                                                                <a href="/manager/player/3" class="btn btn-info">View</a>
                                                                <a href="/manager/player/3/edit" class="btn btn-warning">Edit</a>
                                                                <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#removePlayerModal3">Remove</button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                <% } %>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Join Requests Section -->
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card border-0 shadow-sm">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">Join Requests</h5>
                                </div>
                                <div class="card-body">
                                    <% if (typeof pendingRequestCount !== 'undefined' && pendingRequestCount > 0) { %>
                                        <div class="alert alert-info">
                                            <p>You have <strong><%= pendingRequestCount %></strong> pending join requests.</p>
                                            <a href="/manager/join-requests" class="btn btn-success mt-2">View Requests</a>
                                        </div>
                                    <% } else { %>
                                        <p>No pending join requests.</p>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Remove Player Modals -->
                    <% if (team.players && team.players.length > 0) { %>
                        <% team.players.forEach(player => { %>
                            <div class="modal fade" id="removePlayerModal<%= player.id %>" tabindex="-1" aria-labelledby="removePlayerModalLabel<%= player.id %>" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="removePlayerModalLabel<%= player.id %>">Remove Player</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <p>Are you sure you want to remove <%= player.name %> from your team?</p>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            <form action="/manager/team/<%= team.id %>/remove-player/<%= player.id %>" method="POST">
                                                <button type="submit" class="btn btn-danger">Remove Player</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <!-- Sample Modal for Demo Player 1 -->
                        <div class="modal fade" id="removePlayerModal1" tabindex="-1" aria-labelledby="removePlayerModalLabel1" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="removePlayerModalLabel1">Remove Player</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>Are you sure you want to remove John Smith from your team?</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <form action="/manager/team/<%= team.id %>/remove-player/1" method="POST">
                                            <button type="submit" class="btn btn-danger">Remove Player</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% } %>
                <% } else { %>
                    <div class="alert alert-info">
                        <p>You don't have a team yet. Create your team to get started!</p>
                        <a href="/manager/create-team" class="btn btn-primary mt-3">Create Team</a>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</div>

<!-- Include Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Bootstrap Modal initialization for all modals
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modalEl => {
            new bootstrap.Modal(modalEl);
        });
        
        // 1. Edit Team button functionality
        const editTeamBtn = document.querySelector('.btn-warning[href*="/team/"]');
        if (editTeamBtn) {
            editTeamBtn.addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default to handle manually
                const teamId = this.getAttribute('href').split('/').pop();
                console.log('Editing team with ID:', teamId);
                
                // Show loading state
                this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...';
                this.disabled = true;
                
                // Redirect after a short delay to show the loading state
                setTimeout(() => {
                    window.location.href = this.getAttribute('href');
                }, 500);
            });
        }
        
        // 2. Add Player button functionality
        const addPlayerBtn = document.querySelector('.btn-sm.btn-primary[href*="/members/add"]');
        if (addPlayerBtn) {
            addPlayerBtn.addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default to handle manually
                const teamId = this.getAttribute('href').split('/')[3]; // Extract team ID from URL
                console.log('Adding player to team ID:', teamId);
                
                // Show loading state
                this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...';
                this.disabled = true;
                
                // Redirect after a short delay to show the loading state
                setTimeout(() => {
                    window.location.href = this.getAttribute('href');
                }, 500);
            });
        }
        
        // 3. Player Actions buttons functionality
        // View button
        document.querySelectorAll('.btn-info[href*="/player/"]').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default to handle manually
                const playerId = this.getAttribute('href').split('/').pop();
                console.log('Viewing player details for player ID:', playerId);
                
                // Show loading state
                this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>';
                this.disabled = true;
                
                // Redirect after a short delay to show the loading state
                setTimeout(() => {
                    window.location.href = this.getAttribute('href');
                }, 500);
            });
        });
        
        // Edit button
        document.querySelectorAll('a.btn-warning[href*="/player/"]').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default to handle manually
                const playerId = this.getAttribute('href').split('/').pop();
                console.log('Editing player with ID:', playerId);
                
                // Show loading state
                this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>';
                this.disabled = true;
                
                // Redirect after a short delay to show the loading state
                setTimeout(() => {
                    window.location.href = this.getAttribute('href');
                }, 500);
            });
        });
        
        // Remove button and modal functionality
        document.querySelectorAll('button.btn-danger[data-bs-toggle="modal"]').forEach(btn => {
            btn.addEventListener('click', function() {
                const modalId = this.getAttribute('data-bs-target');
                const playerName = this.closest('tr').querySelector('td:nth-child(2)').textContent;
                console.log('Opening remove modal for player:', playerName);
                
                // Get and show modal
                const modalEl = document.querySelector(modalId);
                if (modalEl) {
                    const modal = new bootstrap.Modal(modalEl);
                    modal.show();
                } else {
                    console.error('Modal not found:', modalId);
                }
            });
        });
        
        // 4. Remove Player confirmation
        document.querySelectorAll('.modal-footer form .btn-danger').forEach(btn => {
            btn.addEventListener('click', function(e) {
                // Don't preventDefault - form should submit naturally
                console.log('Confirming player removal');
                // Show loading indicator
                this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Removing...';
                this.disabled = true;
            });
        });
        
        // 5. Join Requests button (if exists)
        const viewRequestsBtn = document.querySelector('a.btn-success[href="/manager/join-requests"]');
        if (viewRequestsBtn) {
            viewRequestsBtn.addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default to handle manually
                console.log('Viewing join requests');
                
                // Show loading state
                this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...';
                this.disabled = true;
                
                // Redirect after a short delay to show the loading state
                setTimeout(() => {
                    window.location.href = this.getAttribute('href');
                }, 500);
            });
        }
        
        // 6. Create Team button (if exists)
        const createTeamBtn = document.querySelector('.btn-primary[href="/manager/create-team"]');
        if (createTeamBtn) {
            createTeamBtn.addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default to handle manually
                console.log('Creating new team');
                
                // Show loading state
                this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...';
                this.disabled = true;
                
                // Redirect after a short delay to show the loading state
                setTimeout(() => {
                    window.location.href = this.getAttribute('href');
                }, 500);
            });
        }
        
        // 7. Fix modal interaction issues
        document.querySelectorAll('.modal-content').forEach(content => {
            content.addEventListener('click', function(event) {
                event.stopPropagation();
            });
        });
        
        // 8. Cancel buttons in modals
        document.querySelectorAll('.modal-footer .btn-secondary').forEach(btn => {
            btn.addEventListener('click', function() {
                // Close the modal
                const modal = bootstrap.Modal.getInstance(this.closest('.modal'));
                if (modal) {
                    modal.hide();
                }
            });
        });
        
        console.log('All button handlers in My Team page initialized');
    });
</script> 