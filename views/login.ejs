<%- include('partials/header', {title: 'Login - SportsAmigo'}) %>

<section class="sub-header">
    <nav>
        <a href="/"><img src="/images/logooo-removebg-preview.png" class="logo-spin" alt="SportsAmigo Logo"></a>
        <div class="nav-links" id="navLinks">
            <i class="fa fa-times" onclick="hideMenu()"></i>
            <ul>
                <li><a href="/">HOME</a></li>
                <li><a href="/about">ABOUT</a></li>
                <li class="dropdown">
                    <a href="/events">EVENTS</a>
                    <div class="dropdown-content">
                        <a href="/events/football">Football</a>
                        <a href="/events/cricket">Cricket</a>
                        <a href="/events/basketball">Basketball</a>
                    </div>
                </li>
                <li><a href="/contact">CONTACT</a></li>
                <li><a href="/login">LOGIN</a></li>
            </ul>
        </div>
        <i class="fa fa-bars" onclick="showMenu()"></i>
    </nav>

    <h1>Login to Your Account</h1>
</section>

<!-- Login Form Section -->
<section class="login-section">
    <div class="container">
        <div class="login-container">
            <% if (typeof error !== 'undefined' && error) { %>
                <div class="error-message">
                    <%= error %>
                </div>
            <% } %>
            
            <div class="role-selection">
                <h2>Choose Your Role</h2>
                <div class="role-options">
                    <div class="role-card <%= (typeof role !== 'undefined' && role === 'organizer') ? 'active' : '' %>" data-role="organizer">
                        <div class="role-icon">
                            <i class="fa fa-calendar"></i>
                        </div>
                        <h3>Organizer</h3>
                        <p>Create and manage sports events and tournaments</p>
                    </div>
                    <div class="role-card <%= (typeof role !== 'undefined' && role === 'manager') ? 'active' : '' %>" data-role="manager">
                        <div class="role-icon">
                            <i class="fa fa-users"></i>
                        </div>
                        <h3>Manager</h3>
                        <p>Manage teams, players, and coaching staff</p>
                    </div>
                    <div class="role-card <%= (typeof role !== 'undefined' && role === 'player') ? 'active' : '' %>" data-role="player">
                        <div class="role-icon">
                            <i class="fa fa-user"></i>
                        </div>
                        <h3>Player</h3>
                        <p>Access your player dashboard and manage your team activities</p>
                    </div>
                </div>
            </div>
            
            <div class="login-form">
                <h2>Login as <span id="selected-role"><%= typeof role !== 'undefined' ? role.charAt(0).toUpperCase() + role.slice(1) : 'Player' %></span></h2>
                <form action="/login/<%= typeof role !== 'undefined' ? role : 'player' %>" method="post" id="login-form">
                    <input type="hidden" name="role" id="role-input" value="<%= typeof role !== 'undefined' ? role : 'player' %>">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" placeholder="Enter your password" required>
                    </div>
                    <div class="form-group remember-forgot">
                        <div class="remember-me">
                            <input type="checkbox" id="remember" name="remember">
                            <label for="remember">Remember me</label>
                        </div>
                        <a href="#" class="forgot-password" onclick="openForgotPasswordModal()">Forgot Password?</a>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="hero-btn login-btn">Login</button>
                    </div>
                    <div class="register-link">
                        <p>New to SportsAmigo? <a href="/signup/<%= typeof role !== 'undefined' ? role : 'player' %>" id="register-link">Register Now</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- Forgot Password Modal -->
<div id="forgotPasswordModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeForgotPasswordModal()">&times;</span>
        <div class="modal-header">
            <h2>Reset Your Password</h2>
        </div>
        <div class="modal-body">
            <div id="reset-step-1">
                <p>Enter your email address below and we'll send you a link to reset your password.</p>
                <div class="form-group">
                    <label for="reset-email">Email Address</label>
                    <input type="email" id="reset-email" name="reset-email" placeholder="Enter your email" required>
                </div>
                <div class="form-actions">
                    <button class="hero-btn reset-btn" onclick="sendResetLink()">Send Reset Link</button>
                    <button class="hero-btn cancel-btn" onclick="closeForgotPasswordModal()">Cancel</button>
                </div>
            </div>
            <div id="reset-step-2" style="display: none;">
                <div class="success-message">
                    <i class="fa fa-check-circle"></i>
                    <h3>Email Sent!</h3>
                    <p>We've sent a password reset link to your email address. Please check your inbox and follow the instructions to reset your password.</p>
                    <p class="note">If you don't receive an email within a few minutes, please check your spam folder.</p>
                    <button class="hero-btn ok-btn" onclick="closeForgotPasswordModal()">OK</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Role selection functionality
    document.addEventListener('DOMContentLoaded', function() {
        const roleCards = document.querySelectorAll('.role-card');
        const selectedRoleDisplay = document.getElementById('selected-role');
        const roleInput = document.getElementById('role-input');
        const loginForm = document.getElementById('login-form');
        const registerLink = document.getElementById('register-link');
        
        // Set initial role selection
        let selectedRole = '<%= typeof role !== "undefined" ? role : "player" %>';
        
        // Add click event to role cards
        roleCards.forEach(card => {
            card.addEventListener('click', function() {
                // Remove active class from all cards
                roleCards.forEach(c => c.classList.remove('active'));
                
                // Add active class to selected card
                this.classList.add('active');
                
                // Update selected role
                selectedRole = this.getAttribute('data-role');
                selectedRoleDisplay.textContent = selectedRole.charAt(0).toUpperCase() + selectedRole.slice(1);
                roleInput.value = selectedRole;
                
                // Update form action based on role
                loginForm.action = `/login/${selectedRole}`;
                
                // Update register link to match the selected role
                registerLink.href = `/signup/${selectedRole}`;
            });
        });
        
        // Check if there's a role parameter in the URL query string
        const urlParams = new URLSearchParams(window.location.search);
        const queryRole = urlParams.get('role');
        
        if (queryRole && ['player', 'organizer', 'manager'].includes(queryRole)) {
            // Find the card with the matching role
            const queryRoleCard = document.querySelector(`.role-card[data-role="${queryRole}"]`);
            if (queryRoleCard) {
                // Trigger a click on that card
                queryRoleCard.click();
            }
        }
    });
    
    // Forgot password modal functionality
    const forgotPasswordModal = document.getElementById('forgotPasswordModal');
    const resetStep1 = document.getElementById('reset-step-1');
    const resetStep2 = document.getElementById('reset-step-2');
    
    function openForgotPasswordModal() {
        forgotPasswordModal.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Prevent scrolling behind modal
        resetStep1.style.display = 'block';
        resetStep2.style.display = 'none';
    }
    
    function closeForgotPasswordModal() {
        forgotPasswordModal.style.display = 'none';
        document.body.style.overflow = 'auto'; // Re-enable scrolling
        document.getElementById('reset-email').value = ''; // Clear input field
    }
    
    function sendResetLink() {
        const email = document.getElementById('reset-email').value;
        
        // Validate email
        if (!email || !validateEmail(email)) {
            alert('Please enter a valid email address.');
            return;
        }
        
        // In a real application, you would send an AJAX request to your backend
        // to handle the password reset process. For this demo, we'll just show
        // the success message.
        
        // Show success message
        resetStep1.style.display = 'none';
        resetStep2.style.display = 'block';
    }
    
    function validateEmail(email) {
        const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
    }
    
    // Close modal when clicking outside the content
    window.onclick = function(event) {
        if (event.target === forgotPasswordModal) {
            closeForgotPasswordModal();
        }
    };
</script>

<style>
    .error-message {
        background-color: #ffdddd;
        color: #f44336;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
        text-align: center;
        font-weight: 500;
    }
</style>

<%- include('partials/footer') %> 